De acuerdo. He actualizado el plan de migración para '02_Liquidaciones.py' siguiendo tus consejos.

No usaré la herramienta REPLACE. En su lugar, leeré el archivo, haré las modificaciones internamente y lo reescribiré por completo.

Dividiré el trabajo en fases pequeñas y verificables.

---
### Plan de Migración Detallado: 02_Liquidaciones.py
---

**Fase 1: Corregir Rutas e Importaciones Principales**

1.  **Leer `02_Liquidaciones.py`:** Cargar el contenido del script en memoria.
2.  **Modificar Imports:**
    *   Eliminar el bloque de código antiguo que ajusta el `sys.path` y que importa `liquidacion_supabase_handler`.
    *   Añadir el nuevo bloque de código estándar para definir el `project_root` y agregarlo al `sys.path`.
    *   Añadir la importación del nuevo manejador de base de datos: `from src.data import supabase_repository as db`.
3.  **Reescribir Archivo:** Guardar el script con estas primeras modificaciones.
4.  **Verificación (Pausa):** Te pediré que ejecutes la app. No funcionará, pero el error debería cambiar, lo que nos confirmará que este primer paso fue exitoso.

**Fase 2: Actualizar Llamadas a la Base de Datos**

1.  **Leer `02_Liquidaciones.py`:** Cargar el script modificado.
2.  **Reemplazar `db_handler`:** Cambiar todas las llamadas `db_handler.funcion(...)` por `db.funcion(...)`.
3.  **Reescribir Archivo:** Guardar los cambios.
4.  **Verificación (Pausa):** Te pediré que pruebes de nuevo. Ahora la comunicación con la base de datos debería funcionar.

**Fase 3: Internalizar la Generación de Reportes PDF**

1.  **Analizar Generador de PDF:** Investigaré si la función para generar el reporte de lote ya existe en `src/utils/pdf_generators.py`.
    *   Si no existe, la crearé basándome en el script original `lote_report_generator.py`. Este sería un cambio separado y controlado.
2.  **Leer `02_Liquidaciones.py`:** Cargar el script.
3.  **Modificar Generación de PDF:**
    *   Añadir la importación de `pdf_generators` al inicio del archivo.
    *   Eliminar todo el bloque de código que usa `subprocess` para llamar al script externo.
    *   Reemplazarlo con una llamada directa a la función `pdf_generators.generate_lote_report_pdf(...)` y un `st.download_button`.
4.  **Reescribir Archivo:** Guardar la versión final del script.
5.  **Verificación Final:** Te pediré que pruebes la funcionalidad completa, incluyendo la descarga del PDF.

---
Este plan es más seguro y nos permite avanzar paso a paso. Procederé a escribir este plan en el archivo que me indicaste.